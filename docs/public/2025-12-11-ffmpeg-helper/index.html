<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" />
    <title>FFmpeg Helper</title>
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="title-row">
        <h1>FFmpeg Helper</h1>
        <span id="offlineReadyBadge" class="badge hidden" aria-live="polite">Offline ready</span>
        <span id="offlineBadge" class="badge hidden" aria-live="polite">Offline</span>
      </div>
      <p class="subtitle">
        Build reusable ffmpeg commands for Android Termux. This page never runs ffmpeg — it only generates command
        lines.
      </p>
      <button id="updateBanner" class="update-banner hidden" type="button" aria-live="polite">
        Update available — tap to reload
      </button>
    </header>

    <main class="main">
      <details class="howto" id="howto">
        <summary>How to use</summary>
        <div class="howto-body">
          <p>
            Android browsers cannot reveal real filesystem paths. Pick files to get their names, then set base
            directories that Termux can access. The helper combines your base dirs with file names to form paths.
          </p>
          <ul>
            <li>Typical input base dir: <code>/storage/emulated/0/Download</code></li>
            <li>Typical output base dir: <code>/storage/emulated/0/Movies</code></li>
            <li>Termux home: <code>/data/data/com.termux/files/home</code></li>
          </ul>
          <p>
            Placeholders like <code>{inputPath}</code> and <code>{outputPath}</code> are expanded per selected file.
            Copy commands and paste them into Termux bash.
          </p>
        </div>
      </details>

      <details class="howto" id="tips">
        <summary>FFmpeg tips</summary>
        <div class="howto-body">
          <ul>
            <li><code>-i</code> sets the input. Most commands start with <code>ffmpeg -i {inputPath}</code>.</li>
            <li><code>-c copy</code> (or <code>-c:v copy -c:a copy</code>) rewraps without re‑encoding.</li>
            <li><code>-map 0</code> keeps all streams (extra audio tracks, subtitles).</li>
            <li>
              Trimming: <code>-ss</code> start time, <code>-t</code> duration, or <code>-to</code> end time. Use
              <code>-c copy</code> for fast cuts when possible.
            </li>
            <li>
              Quality: <code>-crf</code> controls size/quality (x264 typical 18–23, x265 typical 24–30). Lower is
              better quality and larger files. <code>-preset</code> trades speed for compression.
            </li>
            <li>
              Filtergraphs often need quotes: <code>-vf "fieldmatch,yadif,decimate"</code>. Use straight quotes.
            </li>
            <li>
              In bash loops, add <code>-nostdin</code> before <code>-i</code> to avoid interactive stdin issues.
            </li>
          </ul>
        </div>
      </details>

      <section class="card settings" aria-label="Settings">
        <h2>Settings</h2>
        <div class="field">
          <label for="inputBaseDir">Input base directory</label>
          <input id="inputBaseDir" type="text" placeholder="/storage/emulated/0/Download" autocomplete="off" />
          <div class="hint">Used directly in commands. Must match a real Termux‑visible path.</div>
        </div>

        <div class="field">
          <label for="outputBaseDir">Output base directory</label>
          <input id="outputBaseDir" type="text" placeholder="/storage/emulated/0/Movies" autocomplete="off" />
          <div class="hint">Used directly in commands. Must match a real Termux‑visible path.</div>
        </div>

        <div class="field">
          <label for="outputPattern">Output filename pattern</label>
          <input id="outputPattern" type="text" placeholder="{inputBaseName}_out{inputExt}" autocomplete="off" />
          <div class="chips" role="group" aria-label="Insert placeholder">
            <button class="chip" type="button" data-insert="{inputBaseName}">{inputBaseName}</button>
            <button class="chip" type="button" data-insert="{index1}">{index1}</button>
            <button class="chip" type="button" data-insert="{inputExt}">{inputExt}</button>
            <button class="chip" type="button" data-insert="{inputFileName}">{inputFileName}</button>
          </div>
          <div class="hint">
            Generates <code>{outputFileName}</code>. Example: <code id="outputExample">—</code>
          </div>
        </div>

        <div class="field-row">
          <div class="field half">
            <label for="ffmpegBinary">ffmpeg binary</label>
            <input id="ffmpegBinary" type="text" placeholder="ffmpeg" autocomplete="off" />
            <div class="hint">If templates start with <code>ffmpeg</code>, this value is used instead.</div>
          </div>

          <div class="field half">
            <label for="quoteMode">Quote mode</label>
            <select id="quoteMode">
              <option value="auto">Auto (quote when needed)</option>
              <option value="on">Always quote</option>
              <option value="off">Never quote</option>
            </select>
            <div class="hint">Affects placeholders like <code>{inputPath}</code> and <code>{outputPath}</code>.</div>
          </div>
        </div>

        <div class="field-row">
          <div class="field half">
            <label for="outputFormat">Output format</label>
            <select id="outputFormat">
              <option value="plain">Plain commands</option>
              <option value="script">Bash script</option>
              <option value="oneliner">One‑liner (&&)</option>
            </select>
          </div>
          <div class="field half">
            <label for="sortMode">Sort templates</label>
            <select id="sortMode">
              <option value="category">Category</option>
              <option value="label">Label</option>
              <option value="favorites">Favorites first</option>
              <option value="recent">Recently used</option>
            </select>
          </div>
        </div>

        <div class="reset-row">
          <button id="resetSettings" class="secondary" type="button">Reset settings</button>
          <button id="resetTemplates" class="secondary" type="button">Reset user templates</button>
          <button id="resetFavorites" class="secondary" type="button">Clear favorites</button>
        </div>

        <details class="data">
          <summary>Data import/export</summary>
          <div class="data-body">
            <button id="exportData" type="button">Export JSON backup</button>
            <label class="file-button">
              Import JSON backup
              <input id="importData" type="file" accept="application/json" />
            </label>
          </div>
        </details>
      </section>

      <section class="card sources" aria-label="Source files">
        <h2>Source files</h2>
        <div class="toggle-row" role="radiogroup" aria-label="Source mode">
          <label><input type="radio" name="sourceMode" value="picker" checked /> Picker</label>
          <label><input type="radio" name="sourceMode" value="manual" /> Manual list</label>
        </div>

        <div id="pickerBlock" class="block">
          <label for="sourceFiles" class="file-button">
            Choose files
            <input id="sourceFiles" type="file" multiple />
          </label>
          <div id="selectedFiles" class="selected-files" aria-live="polite">No files selected.</div>
        </div>

        <div id="manualBlock" class="block hidden">
          <label for="manualFiles">File names (one per line)</label>
          <textarea
            id="manualFiles"
            rows="5"
            placeholder="movie.mp4&#10;clip 01.mov"
            autocomplete="off"
          ></textarea>
          <div class="hint">Used as‑is. The picker is ignored in manual mode.</div>
        </div>

        <div class="preview">
          <div class="preview-row">
            <div class="preview-label">Input path preview</div>
            <div id="inputPreview" class="preview-value">—</div>
          </div>
          <div class="preview-row">
            <div class="preview-label">Output path preview</div>
            <div id="outputPreview" class="preview-value">—</div>
          </div>
          <ul id="warnings" class="warnings"></ul>
        </div>
      </section>

      <section class="templates" aria-label="Templates">
        <div class="templates-header">
          <h2>Templates</h2>
          <div class="templates-actions">
            <input id="search" type="search" placeholder="Search templates…" autocomplete="off" />
            <button id="favoritesFilter" class="secondary" type="button" aria-pressed="false">Favorites</button>
            <button id="newTemplate" type="button">New template</button>
          </div>
        </div>
        <div id="templateList" class="template-list"></div>
      </section>

      <details id="diagnostics" class="diagnostics hidden">
        <summary>Diagnostics</summary>
        <pre id="diagnosticsLog"></pre>
      </details>
    </main>

    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

    <dialog id="templateEditor" class="dialog">
      <form method="dialog" id="templateForm">
        <h3 id="templateEditorTitle">New template</h3>
        <input id="templateId" type="hidden" />
        <div class="field">
          <label for="templateLabel">Label *</label>
          <input id="templateLabel" type="text" required autocomplete="off" />
        </div>
        <div class="field">
          <label for="templateDescription">Description</label>
          <textarea id="templateDescription" rows="2" autocomplete="off"></textarea>
        </div>
        <div class="field-row">
          <div class="field half">
            <label for="templateCategory">Category</label>
            <input id="templateCategory" type="text" placeholder="Video" autocomplete="off" />
          </div>
          <div class="field half">
            <label for="templateTags">Tags (comma)</label>
            <input id="templateTags" type="text" placeholder="h264,transcode" autocomplete="off" />
          </div>
        </div>
        <div class="field">
          <label for="templateBody">Command body *</label>
          <textarea id="templateBody" rows="6" required autocomplete="off"></textarea>
          <div class="hint">
            Allowed placeholders:
            <code>{inputPath}</code>, <code>{outputPath}</code>, <code>{inputBaseName}</code>,
            <code>{inputExt}</code>, <code>{inputFileName}</code>, <code>{outputFileName}</code>,
            <code>{index}</code>, <code>{index1}</code>, <code>{inputBaseDir}</code>, <code>{outputBaseDir}</code>,
            <code>{ffmpegBinary}</code>, plus any params you add.
          </div>
        </div>
        <div class="field">
          <label><input id="templateDangerous" type="checkbox" /> Dangerous (requires confirm on copy)</label>
        </div>

        <div class="params">
          <div class="params-header">
            <div>Parameters</div>
            <button id="addParam" class="secondary" type="button">Add param</button>
          </div>
          <div id="paramsList"></div>
        </div>

        <div class="preview-mini">
          <div class="preview-label">Live preview (first file)</div>
          <pre id="templatePreview">Select a file to preview.</pre>
        </div>

        <menu class="dialog-actions">
          <button id="deleteTemplate" class="secondary hidden" type="button">Delete</button>
          <button id="cloneTemplate" class="secondary hidden" type="button">Clone</button>
          <button value="cancel" class="secondary">Cancel</button>
          <button id="saveTemplate" value="default">Save</button>
        </menu>
      </form>
    </dialog>

    <dialog id="importDialog" class="dialog">
      <form method="dialog" id="importForm">
        <h3>Import backup</h3>
        <p>Choose how to apply the imported data.</p>
        <label><input type="radio" name="importMode" value="merge" checked /> Merge (imported wins on id collisions)</label>
        <label><input type="radio" name="importMode" value="replace" /> Replace current user data</label>
        <menu class="dialog-actions">
          <button value="cancel" class="secondary">Cancel</button>
          <button id="confirmImport" value="default">Import</button>
        </menu>
      </form>
    </dialog>

    <script id="builtinTemplates" type="application/xml">
      <templates schemaVersion="1">
        <template id="h264-crf" label="Transcode to H.264 MP4 (CRF)" category="Video" tags="h264,transcode,mp4">
          <description>High‑quality H.264 MP4 with adjustable CRF.</description>
          <params>
            <param id="crf" label="CRF" type="number" default="20" min="0" max="51" step="1" />
            <param id="preset" label="Preset" type="text" default="medium" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c:v libx264 -preset {preset} -crf {crf} -c:a aac -b:a 128k {outputPath}
          ]]></body>
        </template>

        <template id="h265-crf" label="Transcode to H.265/HEVC MP4 (CRF)" category="Video" tags="h265,hevc,transcode,mp4">
          <description>Smaller files with HEVC. Slower encode.</description>
          <params>
            <param id="crf" label="CRF" type="number" default="28" min="0" max="51" step="1" />
            <param id="preset" label="Preset" type="text" default="slow" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c:v libx265 -preset {preset} -crf {crf} -c:a aac -b:a 128k {outputPath}
          ]]></body>
        </template>

        <template id="extract-aac" label="Extract audio to AAC (m4a)" category="Audio" tags="audio,extract,aac,m4a">
          <description>Pull audio stream into an M4A container.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vn -c:a aac -b:a 160k {outputBaseDir}/{inputBaseName}.m4a
          ]]></body>
        </template>

        <template id="extract-mp3" label="Extract audio to MP3" category="Audio" tags="audio,extract,mp3">
          <description>Convert audio track to MP3.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vn -c:a libmp3lame -q:a 2 {outputBaseDir}/{inputBaseName}.mp3
          ]]></body>
        </template>

        <template id="trim-copy" label="Trim segment (copy streams)" category="Video" tags="trim,cut,copy">
          <description>Extract a segment without re‑encoding.</description>
          <params>
            <param id="start" label="Start (hh:mm:ss)" type="text" default="00:00:00" />
            <param id="duration" label="Duration (hh:mm:ss)" type="text" default="00:00:10" />
          </params>
          <body><![CDATA[
ffmpeg -y -ss {start} -i {inputPath} -t {duration} -c copy {outputPath}
          ]]></body>
        </template>

        <template id="speed-change" label="Change speed" category="Video" tags="speed,setpts,atempo">
          <description>Speed up or slow down video and audio.</description>
          <params>
            <param id="factor" label="Speed factor" type="number" default="2.0" step="0.1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -filter_complex "[0:v]setpts=PTS/{factor}[v];[0:a]atempo={factor}[a]" -map "[v]" -map "[a]" {outputPath}
          ]]></body>
        </template>

        <template id="scale-height" label="Scale to height" category="Video" tags="scale,resize,1080p">
          <description>Resize keeping aspect ratio.</description>
          <params>
            <param id="height" label="Height" type="number" default="1080" step="2" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "scale=-2:{height}" -c:v libx264 -crf 20 -preset medium -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="gif-from-video" label="Create GIF from video" category="Video" tags="gif,palette,fps">
          <description>Two‑pass palette method for better GIF quality.</description>
          <params>
            <param id="start" label="Start" type="text" default="00:00:00" />
            <param id="duration" label="Duration" type="text" default="00:00:05" />
            <param id="fps" label="FPS" type="number" default="12" step="1" />
            <param id="width" label="Width" type="number" default="480" step="2" />
          </params>
          <body><![CDATA[
ffmpeg -y -ss {start} -t {duration} -i {inputPath} -vf "fps={fps},scale={width}:-1:flags=lanczos,palettegen" /tmp/palette.png
ffmpeg -y -ss {start} -t {duration} -i {inputPath} -i /tmp/palette.png -lavfi "fps={fps},scale={width}:-1:flags=lanczos[x];[x][1:v]paletteuse" {outputBaseDir}/{inputBaseName}.gif
          ]]></body>
        </template>

        <template id="extract-frames" label="Extract frames to JPEGs" category="Video" tags="frames,images,jpeg">
          <description>Export frames at a fixed FPS.</description>
          <params>
            <param id="fps" label="FPS" type="number" default="1" step="0.5" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "fps={fps}" {outputBaseDir}/{inputBaseName}-frame-%03d.jpg
          ]]></body>
        </template>

        <template id="thumbnail" label="Create thumbnail at time" category="Video" tags="thumbnail,poster">
          <description>Grab a single frame as a thumbnail.</description>
          <params>
            <param id="time" label="Time (hh:mm:ss)" type="text" default="00:00:01" />
          </params>
          <body><![CDATA[
ffmpeg -y -ss {time} -i {inputPath} -frames:v 1 {outputBaseDir}/{inputBaseName}-thumb.jpg
          ]]></body>
        </template>

        <template id="concat-demuxer" label="Concat via list.txt" category="Video" tags="concat,join">
          <description>Join files using the concat demuxer (requires a list file).</description>
          <body><![CDATA[
ffmpeg -y -f concat -safe 0 -i {inputBaseName}_list.txt -c copy {outputPath}
          ]]></body>
          <notes>Create a list file with lines like: file 'part1.mp4'</notes>
        </template>

        <template id="probe" label="Probe metadata (ffprobe)" category="Utility" tags="probe,metadata,ffprobe">
          <description>Show stream and codec info.</description>
          <body><![CDATA[
ffprobe -hide_banner -i {inputPath}
          ]]></body>
        </template>

        <template id="rewrap-copy" label="Rewrap / remux (copy all streams)" category="Video" tags="remux,rewrap,copy">
          <description>Change container without re‑encoding. Keeps all streams.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c copy -map 0 {outputPath}
          ]]></body>
          <notes>Set output extension via Output pattern (e.g., {inputBaseName}.mp4).</notes>
        </template>

        <template id="faststart-remux" label="Enable faststart (copy streams)" category="Video" tags="faststart,streaming,remux">
          <description>Move metadata to file start for faster streaming playback.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c copy -movflags +faststart {outputPath}
          ]]></body>
        </template>

        <template id="h264-android" label="H.264 MP4 for Android (faststart)" category="Video" tags="h264,android,mp4,faststart">
          <description>Compatible MP4 with yuv420p pixel format and faststart.</description>
          <params>
            <param id="crf" label="CRF" type="number" default="20" min="0" max="51" step="1" />
            <param id="preset" label="Preset" type="text" default="slow" />
            <param id="ab" label="Audio bitrate" type="text" default="128k" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c:v libx264 -pix_fmt yuv420p -preset {preset} -crf {crf} -c:a aac -b:a {ab} -movflags +faststart {outputPath}
          ]]></body>
        </template>

        <template id="telegram-720p" label="Telegram‑friendly 720p HEVC" category="Video" tags="telegram,720p,h265,share">
          <description>Downscale to 720p, HEVC video, AAC audio, higher volume.</description>
          <params>
            <param id="crf" label="CRF" type="number" default="23" min="0" max="51" step="1" />
            <param id="preset" label="Preset" type="text" default="slow" />
            <param id="volume" label="Volume gain" type="number" default="5.0" step="0.1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "scale=-2:720" -r 30 -c:v libx265 -preset {preset} -crf {crf} -c:a aac -b:a 48k -af "volume={volume}" {outputPath}
          ]]></body>
        </template>

        <template id="set-fps" label="Change FPS (re‑encode)" category="Video" tags="fps,rate">
          <description>Convert to a target framerate.</description>
          <params>
            <param id="fps" label="FPS" type="number" default="24" step="1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -filter:v fps={fps} -c:v libx264 -crf 20 -preset medium -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="rotate" label="Rotate video (transpose)" category="Video" tags="rotate,transpose">
          <description>Rotate by 90/180/270 using transpose values 0–3.</description>
          <params>
            <param id="transpose" label="Transpose" type="number" default="1" min="0" max="3" step="1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "transpose={transpose}" -c:a copy {outputPath}
          ]]></body>
          <notes>0=90CCW+VFlip, 1=90CW, 2=90CCW, 3=90CW+VFlip.</notes>
        </template>

        <template id="crop" label="Crop video" category="Video" tags="crop,resize">
          <description>Crop to width/height at x/y offset.</description>
          <params>
            <param id="width" label="Width" type="text" default="iw" />
            <param id="height" label="Height" type="text" default="ih" />
            <param id="x" label="X" type="text" default="0" />
            <param id="y" label="Y" type="text" default="0" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "crop={width}:{height}:{x}:{y}" -c:v libx264 -crf 20 -preset medium -c:a copy {outputPath}
          ]]></body>
          <notes>Use iw/ih for input size, or numbers.</notes>
        </template>

        <template id="flip" label="Flip video (hflip/vflip)" category="Video" tags="flip,hflip,vflip">
          <description>Apply a flip filter.</description>
          <params>
            <param id="flipFilter" label="Filter" type="text" default="hflip" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "{flipFilter}" -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="deinterlace-yadif" label="Deinterlace (yadif)" category="Video" tags="deinterlace,yadif">
          <description>Deinterlace and re‑encode to H.264.</description>
          <params>
            <param id="crf" label="CRF" type="number" default="20" min="0" max="51" step="1" />
            <param id="preset" label="Preset" type="text" default="slow" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "yadif,format=yuv420p" -c:v libx264 -preset {preset} -crf {crf} -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="inverse-telecine" label="Inverse telecine" category="Video" tags="telecine,fieldmatch,decimate">
          <description>Reconstruct frames from telecined source.</description>
          <params>
            <param id="crf" label="CRF" type="number" default="20" min="0" max="51" step="1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c:v libx264 -vf "fieldmatch,yadif,decimate" -crf {crf} -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="split-segments" label="Split into segments (copy)" category="Video" tags="segment,split,copy">
          <description>Split file into fixed‑length parts without re‑encoding.</description>
          <params>
            <param id="segmentTime" label="Segment seconds" type="number" default="60" step="1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c copy -map 0 -f segment -segment_time {segmentTime} -reset_timestamps 1 {outputBaseDir}/{inputBaseName}-part-%03d{inputExt}
          ]]></body>
        </template>

        <template id="remove-audio" label="Remove audio (video only)" category="Video" tags="noaudio,strip">
          <description>Keep video stream, drop audio.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c:v copy -an {outputPath}
          ]]></body>
        </template>

        <template id="strip-video-copy-audio" label="Strip video (audio only, copy)" category="Audio" tags="audio-only,copy">
          <description>Remove video, keep audio stream.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vn -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="extract-wav" label="Extract audio to WAV (PCM)" category="Audio" tags="audio,extract,wav,pcm">
          <description>Convert audio track to WAV.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vn -c:a pcm_s16le {outputBaseDir}/{inputBaseName}.wav
          ]]></body>
        </template>

        <template id="volume-gain" label="Increase volume" category="Audio" tags="volume,boost">
          <description>Adjust overall volume by a factor.</description>
          <params>
            <param id="gain" label="Gain factor" type="number" default="3.0" step="0.1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c:v copy -af "volume={gain}" {outputPath}
          ]]></body>
        </template>

        <template id="normalize-loudnorm-video" label="Normalize loudness (loudnorm)" category="Audio" tags="loudnorm,normalize">
          <description>EBU R128 loudness normalization.</description>
          <params>
            <param id="I" label="Target I (LUFS)" type="number" default="-16" step="1" />
            <param id="LRA" label="LRA" type="number" default="11" step="1" />
            <param id="TP" label="True peak" type="number" default="-1.5" step="0.1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -c:v copy -af "loudnorm=I={I}:LRA={LRA}:TP={TP}" {outputPath}
          ]]></body>
        </template>

        <template id="mute-segment" label="Mute audio segment" category="Audio" tags="mute,volume,segment">
          <description>Silence audio between start and end seconds.</description>
          <params>
            <param id="start" label="Start (s)" type="number" default="0" step="1" />
            <param id="end" label="End (s)" type="number" default="10" step="1" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vcodec copy -af "volume=enable='between(t,{start},{end})':volume=0" {outputPath}
          ]]></body>
        </template>

        <template id="delay-audio" label="Delay audio" category="Audio" tags="delay,itsoffset">
          <description>Delay audio by N seconds (positive delays audio later).</description>
          <params>
            <param id="offset" label="Offset (s)" type="number" default="3.84" step="0.01" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -itsoffset {offset} -i {inputPath} -map 0:v -map 1:a -c:v copy -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="delay-video" label="Delay video" category="Video" tags="delay,itsoffset">
          <description>Delay video by N seconds (positive delays video later).</description>
          <params>
            <param id="offset" label="Offset (s)" type="number" default="3.84" step="0.01" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -itsoffset {offset} -i {inputPath} -map 1:v -map 0:a -c:v copy -c:a copy {outputPath}
          ]]></body>
        </template>

        <template id="subtitle-srt-to-ass" label="Convert SRT to ASS" category="Subtitles" tags="subtitles,srt,ass">
          <description>Convert subtitles to .ass for burning.</description>
          <body><![CDATA[
ffmpeg -y -i {inputPath} {outputBaseDir}/{inputBaseName}.ass
          ]]></body>
        </template>

        <template id="subtitle-burn-ass" label="Burn ASS subtitles" category="Subtitles" tags="subtitles,burn,ass">
          <description>Burn subtitles into video frames.</description>
          <params>
            <param id="subAssPath" label="ASS path" type="text" default="subs.ass" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "ass={subAssPath}" {outputPath}
          ]]></body>
          <notes>Convert SRT to ASS first if needed.</notes>
        </template>

        <template id="subtitle-embed-movtext" label="Embed subtitles (mov_text)" category="Subtitles" tags="subtitles,embed,mp4">
          <description>Embed a subtitle file into MP4/MKV.</description>
          <params>
            <param id="subtitlePath" label="Subtitle path" type="text" default="subs.srt" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -i {subtitlePath} -c copy -c:s mov_text {outputPath}
          ]]></body>
        </template>

        <template id="watermark-image" label="Overlay image watermark" category="Watermark" tags="watermark,overlay,image">
          <description>Overlay a PNG/JPG watermark in the top‑right corner.</description>
          <params>
            <param id="watermarkPath" label="Watermark path" type="text" default="watermark.png" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -i {watermarkPath} -filter_complex "overlay=main_w-overlay_w-5:5" {outputPath}
          ]]></body>
        </template>

        <template id="watermark-text" label="Centered text watermark" category="Watermark" tags="watermark,text,drawtext">
          <description>Add centered semi‑transparent text.</description>
          <params>
            <param id="text" label="Text" type="text" default="WATERMARK" />
            <param id="fontSize" label="Font size" type="number" default="36" step="1" />
            <param id="alpha" label="Alpha (0‑1)" type="number" default="0.4" step="0.05" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -vf "drawtext=text='{text}':fontsize={fontSize}:fontcolor=white@{alpha}:x=(w-text_w)/2:y=(h-text_h)/2" {outputPath}
          ]]></body>
          <notes>Avoid apostrophes in text or edit the filter manually.</notes>
        </template>

        <template id="hstack-two" label="Stack two videos horizontally" category="Composite" tags="hstack,side-by-side">
          <description>Combine current file with another video (second path is manual).</description>
          <params>
            <param id="input2Path" label="Second input path" type="text" default="second.mp4" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -i {input2Path} -filter_complex hstack=inputs=2 {outputPath}
          ]]></body>
        </template>

        <template id="vstack-two" label="Stack two videos vertically" category="Composite" tags="vstack,top-bottom">
          <description>Combine current file with another video (second path is manual).</description>
          <params>
            <param id="input2Path" label="Second input path" type="text" default="second.mp4" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -i {input2Path} -filter_complex vstack=inputs=2 {outputPath}
          ]]></body>
        </template>

        <template id="idet" label="Detect interlacing (idet)" category="Utility" tags="idet,interlace,analyze">
          <description>Analyze interlacing; no output file is produced.</description>
          <body><![CDATA[
ffmpeg -i {inputPath} -filter:v idet -f null -
          ]]></body>
          <notes>Runs analysis only. Look at console output in Termux.</notes>
        </template>

        <template id="set-title" label="Set metadata title" category="Utility" tags="metadata,title">
          <description>Replace title metadata while copying streams.</description>
          <params>
            <param id="title" label="Title" type="text" default="My Title" />
          </params>
          <body><![CDATA[
ffmpeg -y -i {inputPath} -map_metadata -1 -metadata title="{title}" -c copy {outputPath}
          ]]></body>
        </template>
      </templates>
    </script>

    <script src="main.js"></script>
  </body>
</html>
