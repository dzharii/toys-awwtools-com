/**
 * Japanese Language Learning Exercises Data
 * Contains structured exercises with activities for learning Japanese
 */

// Exercise data structure with Japanese content
const exercisesData = [
    {
        id: 'basics-1',
        title: 'Basics 1',
        description: 'Learn essential Japanese phrases and greetings',
        icon: 'üëã',
        difficulty: 'beginner',
        activities: [
            {
                type: 'multipleChoice',
                prompt: 'Select the meaning of "„Åì„Çì„Å´„Å°„ÅØ"',
                audio: 'konnichiwa.mp3',
                options: [
                    { text: 'Hello', isCorrect: true },
                    { text: 'Goodbye', isCorrect: false },
                    { text: 'Thank you', isCorrect: false },
                    { text: 'Excuse me', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„Åì„Çì„Å´„Å°„ÅØ" (Konnichiwa) means "Hello"',
                    incorrect: 'Not quite. "„Åì„Çì„Å´„Å°„ÅØ" (Konnichiwa) means "Hello"'
                }
            },
            {
                type: 'typing',
                prompt: 'Type the romaji for "„Åï„Çà„ÅÜ„Å™„Çâ"',
                audio: 'sayounara.mp3',
                answer: 'sayounara',
                alternatives: ['sayonara'],
                feedback: {
                    correct: 'Great job! "„Åï„Çà„ÅÜ„Å™„Çâ" is "sayounara" which means "goodbye"',
                    incorrect: 'The correct answer is "sayounara", which means "goodbye"'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'Which is "Thank you" in Japanese?',
                options: [
                    { text: '„ÅÇ„Çä„Åå„Å®„ÅÜ', isCorrect: true },
                    { text: '„Åô„Åø„Åæ„Åõ„Çì', isCorrect: false },
                    { text: '„Åä„ÅØ„Çà„ÅÜ', isCorrect: false },
                    { text: '„ÅÑ„ÅÑ„Åà', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„ÅÇ„Çä„Åå„Å®„ÅÜ" (Arigatou) means "Thank you"',
                    incorrect: 'Not quite. "„ÅÇ„Çä„Åå„Å®„ÅÜ" (Arigatou) means "Thank you"'
                }
            },
            {
                type: 'matching',
                prompt: 'Match the Japanese greetings with their meanings',
                pairs: [
                    { left: '„Åä„ÅØ„Çà„ÅÜ', right: 'Good morning' },
                    { left: '„Åì„Çì„Å∞„Çì„ÅØ', right: 'Good evening' },
                    { left: '„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ', right: 'Good night' },
                    { left: '„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶', right: 'Nice to meet you' }
                ],
                feedback: {
                    correct: 'Excellent! You matched all the greetings correctly!',
                    incorrect: 'Some matches are incorrect. Try again!'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'How do you say "Yes" in Japanese?',
                options: [
                    { text: '„ÅØ„ÅÑ', isCorrect: true },
                    { text: '„ÅÑ„ÅÑ„Åà', isCorrect: false },
                    { text: '„Çè„Åã„Çä„Åæ„Åõ„Çì', isCorrect: false },
                    { text: '„Åô„Åø„Åæ„Åõ„Çì', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„ÅØ„ÅÑ" (Hai) means "Yes"',
                    incorrect: 'Not quite. "„ÅØ„ÅÑ" (Hai) means "Yes"'
                }
            }
        ]
    },
    {
        id: 'hiragana-1',
        title: 'Hiragana 1',
        description: 'Learn the first set of Hiragana characters',
        icon: '„ÅÇ',
        difficulty: 'beginner',
        activities: [
            {
                type: 'multipleChoice',
                prompt: 'What is this character? „ÅÇ',
                options: [
                    { text: 'a', isCorrect: true },
                    { text: 'i', isCorrect: false },
                    { text: 'u', isCorrect: false },
                    { text: 'e', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„ÅÇ" is pronounced as "a"',
                    incorrect: 'Not quite. "„ÅÇ" is pronounced as "a"'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'What is this character? „ÅÑ',
                options: [
                    { text: 'a', isCorrect: false },
                    { text: 'i', isCorrect: true },
                    { text: 'u', isCorrect: false },
                    { text: 'e', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„ÅÑ" is pronounced as "i"',
                    incorrect: 'Not quite. "„ÅÑ" is pronounced as "i"'
                }
            },
            {
                type: 'typing',
                prompt: 'Type the romaji for the character: „ÅÜ',
                answer: 'u',
                feedback: {
                    correct: 'Great! "„ÅÜ" is pronounced as "u"',
                    incorrect: 'The correct romaji for "„ÅÜ" is "u"'
                }
            },
            {
                type: 'matching',
                prompt: 'Match the hiragana to their romaji',
                pairs: [
                    { left: '„Åà', right: 'e' },
                    { left: '„Åä', right: 'o' },
                    { left: '„Åã', right: 'ka' },
                    { left: '„Åç', right: 'ki' }
                ],
                feedback: {
                    correct: 'Excellent! You matched all characters correctly!',
                    incorrect: 'Some matches are incorrect. Try again!'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'Which character is "sa"?',
                options: [
                    { text: '„Åï', isCorrect: true },
                    { text: '„Åó', isCorrect: false },
                    { text: '„Åô', isCorrect: false },
                    { text: '„Åõ', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„Åï" is "sa"',
                    incorrect: 'Not quite. "„Åï" is "sa"'
                }
            }
        ]
    },
    {
        id: 'katakana-1',
        title: 'Katakana 1',
        description: 'Learn the first set of Katakana characters',
        icon: '„Ç¢',
        difficulty: 'beginner',
        activities: [
            {
                type: 'multipleChoice',
                prompt: 'What is this character? „Ç¢',
                options: [
                    { text: 'a', isCorrect: true },
                    { text: 'i', isCorrect: false },
                    { text: 'u', isCorrect: false },
                    { text: 'e', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„Ç¢" is pronounced as "a"',
                    incorrect: 'Not quite. "„Ç¢" is pronounced as "a"'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'What is this character? „Ç§',
                options: [
                    { text: 'a', isCorrect: false },
                    { text: 'i', isCorrect: true },
                    { text: 'u', isCorrect: false },
                    { text: 'e', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„Ç§" is pronounced as "i"',
                    incorrect: 'Not quite. "„Ç§" is pronounced as "i"'
                }
            },
            {
                type: 'typing',
                prompt: 'Type the romaji for the character: „Ç¶',
                answer: 'u',
                feedback: {
                    correct: 'Great! "„Ç¶" is pronounced as "u"',
                    incorrect: 'The correct romaji for "„Ç¶" is "u"'
                }
            },
            {
                type: 'matching',
                prompt: 'Match the katakana to their romaji',
                pairs: [
                    { left: '„Ç®', right: 'e' },
                    { left: '„Ç™', right: 'o' },
                    { left: '„Ç´', right: 'ka' },
                    { left: '„Ç≠', right: 'ki' }
                ],
                feedback: {
                    correct: 'Excellent! You matched all characters correctly!',
                    incorrect: 'Some matches are incorrect. Try again!'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'Which character is "sa" in katakana?',
                options: [
                    { text: '„Çµ', isCorrect: true },
                    { text: '„Ç∑', isCorrect: false },
                    { text: '„Çπ', isCorrect: false },
                    { text: '„Çª', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„Çµ" is "sa"',
                    incorrect: 'Not quite. "„Çµ" is "sa"'
                }
            }
        ]
    },
    {
        id: 'phrases-1',
        title: 'Common Phrases',
        description: 'Learn everyday Japanese expressions',
        icon: 'üí¨',
        difficulty: 'intermediate',
        activities: [
            {
                type: 'multipleChoice',
                prompt: 'What does "„ÅäÂÖÉÊ∞ó„Åß„Åô„Åã" mean?',
                audio: 'ogenki-desuka.mp3',
                options: [
                    { text: 'How are you?', isCorrect: true },
                    { text: 'Where are you?', isCorrect: false },
                    { text: 'What is your name?', isCorrect: false },
                    { text: 'How old are you?', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„ÅäÂÖÉÊ∞ó„Åß„Åô„Åã" (O-genki desu ka) means "How are you?"',
                    incorrect: 'Not quite. "„ÅäÂÖÉÊ∞ó„Åß„Åô„Åã" (O-genki desu ka) means "How are you?"'
                }
            },
            {
                type: 'typing',
                prompt: 'Type the meaning of "ÁßÅ„ÅÆÂêçÂâç„ÅØ [your name] „Åß„Åô"',
                answer: 'my name is',
                alternatives: ['i am called', 'my name is called', 'i am', 'i\'m called', 'i\'m'],
                feedback: {
                    correct: 'Great job! "ÁßÅ„ÅÆÂêçÂâç„ÅØ [your name] „Åß„Åô" (Watashi no namae wa [your name] desu) means "My name is [your name]"',
                    incorrect: 'The phrase "ÁßÅ„ÅÆÂêçÂâç„ÅØ [your name] „Åß„Åô" (Watashi no namae wa [your name] desu) means "My name is [your name]"'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'Which phrase means "I don\'t understand"?',
                options: [
                    { text: '„Çè„Åã„Çä„Åæ„Åõ„Çì', isCorrect: true },
                    { text: '„Åô„Åø„Åæ„Åõ„Çì', isCorrect: false },
                    { text: '„Å©„ÅÜ„ÅÑ„Åü„Åó„Åæ„Åó„Å¶', isCorrect: false },
                    { text: '„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "„Çè„Åã„Çä„Åæ„Åõ„Çì" (Wakarimasen) means "I don\'t understand"',
                    incorrect: 'Not quite. "„Çè„Åã„Çä„Åæ„Åõ„Çì" (Wakarimasen) means "I don\'t understand"'
                }
            },
            {
                type: 'matching',
                prompt: 'Match these useful phrases with their meanings',
                pairs: [
                    { left: '„Åô„Åø„Åæ„Åõ„Çì', right: 'Excuse me/Sorry' },
                    { left: '„ÅÑ„Åü„Å†„Åç„Åæ„Åô', right: 'Thank you for the food (before eating)' },
                    { left: '„Åî„Å°„Åù„ÅÜ„Åï„Åæ„Åß„Åó„Åü', right: 'Thank you for the meal (after eating)' },
                    { left: '„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', right: 'Please' }
                ],
                feedback: {
                    correct: 'Excellent! You matched all phrases correctly!',
                    incorrect: 'Some matches are incorrect. Try again!'
                }
            },
            {
                type: 'typing',
                prompt: 'What is "„Åæ„ÅüÊòéÊó•" in English?',
                answer: 'see you tomorrow',
                alternatives: ['until tomorrow', 'tomorrow again', 'see you again tomorrow'],
                feedback: {
                    correct: 'Correct! "„Åæ„ÅüÊòéÊó•" (Mata ashita) means "See you tomorrow"',
                    incorrect: 'The phrase "„Åæ„ÅüÊòéÊó•" (Mata ashita) means "See you tomorrow"'
                }
            }
        ]
    },
    {
        id: 'numbers-1',
        title: 'Numbers & Counting',
        description: 'Learn to count in Japanese',
        icon: 'üî¢',
        difficulty: 'beginner',
        activities: [
            {
                type: 'multipleChoice',
                prompt: 'What is "‰∏Ä" („ÅÑ„Å°) in English?',
                options: [
                    { text: '1', isCorrect: true },
                    { text: '2', isCorrect: false },
                    { text: '3', isCorrect: false },
                    { text: '4', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "‰∏Ä" („ÅÑ„Å°, ichi) is 1',
                    incorrect: 'Not quite. "‰∏Ä" („ÅÑ„Å°, ichi) is 1'
                }
            },
            {
                type: 'typing',
                prompt: 'Write the romaji for "‰∏â" (number 3)',
                answer: 'san',
                feedback: {
                    correct: 'Great! "‰∏â" („Åï„Çì, san) is 3',
                    incorrect: 'The correct romaji for "‰∏â" is "san" („Åï„Çì), which means 3'
                }
            },
            {
                type: 'matching',
                prompt: 'Match these Japanese numbers with their values',
                pairs: [
                    { left: '‰∫î („Åî)', right: '5' },
                    { left: '‰∏É („Å™„Å™/„Åó„Å°)', right: '7' },
                    { left: '‰πù („Åç„ÇÖ„ÅÜ/„Åè)', right: '9' },
                    { left: 'ÂçÅ („Åò„ÇÖ„ÅÜ)', right: '10' }
                ],
                feedback: {
                    correct: 'Excellent! You matched all numbers correctly!',
                    incorrect: 'Some matches are incorrect. Try again!'
                }
            },
            {
                type: 'multipleChoice',
                prompt: 'How do you say 100 in Japanese?',
                options: [
                    { text: 'Áôæ („Å≤„ÇÉ„Åè)', isCorrect: true },
                    { text: 'ÂçÉ („Åõ„Çì)', isCorrect: false },
                    { text: '‰∏á („Åæ„Çì)', isCorrect: false },
                    { text: 'ÂçÅ („Åò„ÇÖ„ÅÜ)', isCorrect: false }
                ],
                feedback: {
                    correct: 'Correct! "Áôæ" („Å≤„ÇÉ„Åè, hyaku) is 100',
                    incorrect: 'Not quite. "Áôæ" („Å≤„ÇÉ„Åè, hyaku) is 100'
                }
            },
            {
                type: 'typing',
                prompt: 'How do you write 1000 in Japanese kanji?',
                answer: 'ÂçÉ',
                alternatives: ['sen'],
                feedback: {
                    correct: 'Correct! "ÂçÉ" („Åõ„Çì, sen) is 1000',
                    incorrect: 'The correct answer is "ÂçÉ" („Åõ„Çì, sen), which means 1000'
                }
            }
        ]
    }
];

// Function to get exercise by id
function getExerciseById(id) {
    return exercisesData.find(exercise => exercise.id === id);
}

// Function to get all exercises
function getAllExercises() {
    return exercisesData;
}

// Store user progress in localStorage
function saveUserProgress(exerciseId, completedActivities, score) {
    const userProgress = getUserProgress();
    
    userProgress[exerciseId] = {
        completedActivities: completedActivities,
        score: score,
        lastUpdated: new Date().toISOString()
    };
    
    localStorage.setItem('nihongo_user_progress', JSON.stringify(userProgress));
}

// Get user progress from localStorage
function getUserProgress() {
    const progress = localStorage.getItem('nihongo_user_progress');
    return progress ? JSON.parse(progress) : {};
}

// Get user's score for a specific exercise
function getExerciseScore(exerciseId) {
    const userProgress = getUserProgress();
    return userProgress[exerciseId]?.score || 0;
}

// Get user's completed activities for a specific exercise
function getCompletedActivities(exerciseId) {
    const userProgress = getUserProgress();
    return userProgress[exerciseId]?.completedActivities || 0;
}

// Get user stats (streak and points)
function getUserStats() {
    const stats = localStorage.getItem('nihongo_user_stats');
    return stats ? JSON.parse(stats) : { streak: 0, points: 0, lastActivity: null };
}

// Update user stats
function updateUserStats(pointsEarned) {
    const stats = getUserStats();
    const today = new Date().toISOString().split('T')[0];
    
    // Update points
    stats.points += pointsEarned;
    
    // Update streak
    if (stats.lastActivity) {
        const lastActivityDate = new Date(stats.lastActivity).toISOString().split('T')[0];
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        if (lastActivityDate === today) {
            // Already logged activity today, streak unchanged
        } else if (lastActivityDate === yesterdayStr) {
            // Activity yesterday, increment streak
            stats.streak += 1;
        } else {
            // Activity gap, reset streak
            stats.streak = 1;
        }
    } else {
        // First activity ever
        stats.streak = 1;
    }
    
    stats.lastActivity = today;
    
    localStorage.setItem('nihongo_user_stats', JSON.stringify(stats));
    return stats;
}

